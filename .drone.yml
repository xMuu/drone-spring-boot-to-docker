kind: pipeline
type: docker
name: defalue

steps:
  - name: build app
    image: maven:3.8.4-jdk-11
    volumes:
      - name: maven-build
        path: /app/build
      - name: maven-cache
        path: /root/.m2
    commands:
      - mvn clean package
      - cp target/*.jar /app/build

  - name: send telegram notification
    image: appleboy/drone-telegram
    settings:
      token:
        from_secret: BOT_TOKEN
      to:
        from_secret: USER_ID
      format: html
#      message: >
#        <b>Repo Info:</b>
#        <br>
#        {{repo.name}}@{{commit.branch}}
#        <b>Author Info:</b>
#        {{commit.author}} ({{commit.email}})
#        <b>Commit:</b>
#        {{truncate commit.sha 8}}
#        <b>Commit Message:</b>
#        {{commit.message}}
#        <b>Build Number:</b>
#        {{build.number}}
#        <b>Since:</b>
#        {{datetime build.started "2022-01-01 08:08:08" "Asia/Shanghai"}}
#        <b>Build Time:</b>
#        {{since build.started}}
#        <b>Result:</b>
#        {{#success build.status}}
#        Succeeded. Good job.
#        {{else}}
#        Failed. Fix me please.
#        {{/success}}

volumes:
  - name: maven-build
    host:
      path: /home/ubuntu/DroneVolumes/maven/build
  - name: maven-cache
    host:
      path: /home/ubuntu/DroneVolumes/maven/cache
